# Sonnet vs Opus - 使い分けガイド

最終更新: 2025-11-02

---

## 🎯 結論（先に読む）

**基本は Sonnet 4.5 を使用**
- 日常的な開発
- 機能実装
- バグ修正
- ドキュメント作成

**Opus 4 は特別な時だけ**
- 複雑な設計判断
- 難解なバグ
- 最終レビュー
- アーキテクチャ変更

---

## 📊 モデル比較表

| 項目 | Sonnet 4.5 | Opus 4 |
|------|------------|--------|
| **コーディング能力** | ⭐⭐⭐⭐ | ⭐⭐⭐⭐⭐ |
| **速度** | 🚀 速い | 🐢 遅い |
| **コスト** | 💰 $3-15/1M tokens | 💰💰💰 $15-75/1M tokens |
| **日常使い** | ✅ 最適 | ⚠️ オーバースペック |
| **複雑な問題** | △ やや苦戦 | ✅ 得意 |
| **推奨度** | 90%のタスク | 10%のタスク |

---

## ✅ Sonnet 4.5 を使うシーン

### Phase 1: 基盤構築
- [x] Node.js / 11ty セットアップ
- [x] package.json 作成
- [x] ディレクトリ構成作成
- [x] コンポーネント作成（header, footer等）
- [x] ページ作成（index, 詳細ページ）
- [x] CSS スタイリング
- [x] 基本的なJavaScript実装

**理由:** 
- 定型的なセットアップ作業
- ドキュメント通りに進められる
- Sonnetで十分な品質

---

### Phase 2: 認証システム
- [x] Twitter OAuth 基本実装
- [x] Passport.js セットアップ
- [x] ログイン/ログアウト機能
- [x] セッション管理（基本）
- [x] フロントエンド（ログインボタン、モーダル）

**理由:**
- 既存のライブラリ・パターンを使用
- ドキュメントが豊富
- Sonnetで問題なく実装可能

---

### Phase 3: データベース
- [x] Supabase セットアップ
- [x] テーブル作成（基本的なCRUD）
- [x] API エンドポイント作成
- [x] フロントエンドとの接続

**理由:**
- 標準的なDB操作
- Supabaseの公式ドキュメントが充実
- Sonnetで十分

---

### Phase 4-6: 機能実装
- [x] 見積もりフォーム
- [x] 依頼作成・一覧
- [x] プロフィール編集
- [x] 音声アップロード
- [x] レビュー表示
- [x] 決済リンク設定

**理由:**
- 標準的なCRUD操作
- UIコンポーネント作成
- Sonnetの得意分野

---

### 日常的なタスク
- [x] 軽微なバグ修正
- [x] スタイル調整
- [x] 文言変更
- [x] 新しい機能の追加（標準的なもの）
- [x] ドキュメント更新
- [x] コードのリファクタリング（小規模）

**理由:**
- 高速なレスポンス
- コスト効率
- 十分な品質

---

## 🏆 Opus 4 を使うシーン

### 🎯 アーキテクチャ・設計

#### 重要な技術選定
```
❌ Sonnet: 「Supabaseが良いと思います」
✅ Opus:   「Supabase vs Firebase vs PostgreSQL を
           スケーラビリティ、コスト、開発速度、
           保守性の観点から比較すると...」
```

**使用タイミング:**
- [ ] データベース選定の最終決定
- [ ] 認証システムの設計
- [ ] 決済システムの選定
- [ ] ホスティング選定（Netlify vs Vercel）

---

#### スケーラビリティ設計
```
✅ Opus 使用:
- 将来10,000ユーザーになった時の対策
- データベースのパーティショニング戦略
- キャッシュ戦略
- CDN設計
```

**使用タイミング:**
- [ ] Phase 8（最適化）の計画時
- [ ] 大規模リファクタリング前

---

### 🔥 複雑な問題・バグ

#### Sonnetで2-3回試しても解決しない
```
Sonnet: 試行1 → ダメ
Sonnet: 試行2 → ダメ
Sonnet: 試行3 → ダメ
↓
Opus: 根本原因を特定 → 解決！
```

**使用タイミング:**
- [ ] 原因不明のエラー
- [ ] パフォーマンス問題
- [ ] セキュリティ脆弱性
- [ ] 複雑なロジックのバグ

---

#### メモリリーク・パフォーマンス問題
```
✅ Opus 使用:
- プロファイリング結果の分析
- ボトルネックの特定
- 最適化戦略の提案
- O(n²) → O(n log n) 改善
```

**使用タイミング:**
- [ ] ページ読み込みが3秒以上
- [ ] メモリ使用量が異常
- [ ] データベースクエリが遅い

---

### 🛡️ セキュリティ

#### セキュリティ監査
```
✅ Opus 使用:
- XSS 脆弱性チェック
- CSRF 対策確認
- SQL Injection 対策
- 認証フローのレビュー
- データベース権限設定
```

**使用タイミング:**
- [ ] 本番デプロイ前
- [ ] 認証機能実装後
- [ ] 決済機能実装後

---

#### OAuth実装の最終確認
```
✅ Opus 使用:
- Twitter OAuth のセキュリティホール確認
- トークンの保存方法レビュー
- セッション管理の安全性確認
```

**使用タイミング:**
- [ ] Phase 2 完了時の最終レビュー

---

### 📈 最適化・チューニング

#### パフォーマンス最適化
```
✅ Opus 使用:
- 画像の遅延読み込み戦略
- バンドルサイズの削減
- キャッシュ戦略
- データベースインデックス設計
```

**使用タイミング:**
- [ ] Phase 8: 最適化フェーズ
- [ ] Lighthouse スコアが80以下

---

#### データベース最適化
```
✅ Opus 使用:
- クエリの最適化
- インデックス設計
- N+1問題の解決
- データベース正規化のレビュー
```

**使用タイミング:**
- [ ] ユーザー数が100を超えた時
- [ ] クエリが1秒以上かかる時

---

### 🎨 複雑なUI/UX

#### 複雑なインタラクション
```
✅ Opus 使用:
- ドラッグ&ドロップ
- リアルタイム同期
- 複雑なアニメーション
- カスタムオーディオプレイヤー
```

**使用タイミング:**
- [ ] 音声プレイヤーのカスタマイズ
- [ ] リアルタイムチャット機能（将来）

---

### 📚 コードレビュー

#### 重要なマイルストーン後
```
✅ Opus 使用:
- Phase 完了時の総合レビュー
- セキュリティチェック
- パフォーマンスチェック
- ベストプラクティス確認
```

**使用タイミング:**
- [ ] Phase 2 完了後（認証システム）
- [ ] Phase 4 完了後（依頼機能）
- [ ] Phase 6 完了後（声優機能）
- [ ] Phase 8 完了後（最適化）
- [ ] 本番デプロイ前

---

## 🤔 判断フローチャート
```
タスクが発生
    ↓
これは複雑？
    ├─ NO → Sonnet 4.5
    └─ YES
        ↓
    Sonnetで解決できた？
        ├─ YES → Sonnet 4.5
        └─ NO
            ↓
        2-3回試した？
            ├─ NO → もう一度 Sonnet
            └─ YES → Opus 4
```

---

## 💰 コスト管理

### 月間目安（開発中）

#### Sonnet 中心の場合
```
1日あたり: $1-3
月額: $30-90
```

#### Opus を頻繁に使う場合
```
1日あたり: $5-15
月額: $150-450
```

### 推奨バランス
```
Sonnet: 90% のタスク
Opus:   10% のタスク
↓
月額コスト: $50-120（目安）
```

---

## 📝 実践例

### ケーススタディ 1: バグ修正

#### シナリオ
「ログインボタンが反応しない」

**Step 1: Sonnet で試す**
```
→ コンソールエラー確認
→ イベントリスナー確認
→ 修正案提示
→ 解決！✅
```

**時間:** 5分  
**コスト:** $0.10

---

#### シナリオ（複雑版）
「ログイン後、ランダムに403エラー」

**Step 1: Sonnet で試す**
```
→ セッション確認
→ Cookie 確認
→ 解決せず ❌
```

**Step 2: もう一度 Sonnet**
```
→ CSRF トークン確認
→ 解決せず ❌
```

**Step 3: Opus に切り替え**
```
→ セッションストアのrace condition を発見
→ Redis 導入を提案
→ 解決！✅
```

**時間:** 30分  
**コスト:** $0.50

---

### ケーススタディ 2: 新機能実装

#### シナリオ
「見積もりフォームを作りたい」

**使用モデル:** Sonnet 4.5 ✅

**理由:**
- 標準的なフォーム実装
- 文字数カウント（シンプルなJS）
- 金額計算（基本的な演算）

**時間:** 20分  
**コスト:** $0.20

---

#### シナリオ
「リアルタイムチャット機能」

**Step 1: Sonnet で基本設計**
```
→ WebSocket 提案
→ 基本的な実装案
```

**Step 2: Opus でアーキテクチャレビュー**
```
→ Socket.io vs WebSocket ネイティブ比較
→ スケーラビリティ戦略
→ メッセージキューイング設計
→ 最適な実装パターン提示
```

**時間:** 2時間  
**コスト:** $2-3

---

## ⚠️ 注意点

### Opus を使いすぎない

#### ❌ BAD
```
- 変数名を変える → Opus
- CSSの色を変える → Opus  
- タイポ修正 → Opus
```
**理由:** コストが無駄。Sonnetで十分。

#### ✅ GOOD
```
- 変数名を変える → Sonnet
- CSSの色を変える → Sonnet
- タイポ修正 → Sonnet

- アーキテクチャ変更 → Opus
- セキュリティ監査 → Opus
```

---

### Sonnet で粘りすぎない

#### ❌ BAD
```
Sonnet: 試行1 → ダメ
Sonnet: 試行2 → ダメ
Sonnet: 試行3 → ダメ
Sonnet: 試行4 → ダメ
Sonnet: 試行5 → ダメ
（時間とコストが無駄）
```

#### ✅ GOOD
```
Sonnet: 試行1 → ダメ
Sonnet: 試行2 → ダメ
Sonnet: 試行3 → ダメ
↓
Opus に切り替え → 解決！
```

---

## 🎯 Phase別 推奨モデル

### Phase 1: 基盤構築
- **メイン:** Sonnet 4.5
- **Opus使用:** なし
- **理由:** セットアップ作業のみ

### Phase 2: 認証システム
- **メイン:** Sonnet 4.5
- **Opus使用:** セキュリティレビュー（Phase完了時）
- **理由:** 標準実装 + 最終確認

### Phase 3: データベース
- **メイン:** Sonnet 4.5
- **Opus使用:** DB設計の最終レビュー
- **理由:** CRUD実装は標準的

### Phase 4-6: 機能実装
- **メイン:** Sonnet 4.5
- **Opus使用:** 複雑なUI実装時のみ
- **理由:** 標準的な機能実装

### Phase 7: コラボ機能
- **メイン:** Sonnet 4.5
- **Opus使用:** なし
- **理由:** シンプルな機能

### Phase 8: 最適化
- **メイン:** Opus 4
- **Opus使用:** パフォーマンス分析、最適化戦略
- **理由:** 複雑な最適化作業

### Phase 9: 本番デプロイ
- **メイン:** Sonnet 4.5
- **Opus使用:** デプロイ前の最終セキュリティ監査
- **理由:** デプロイは標準作業、監査は慎重に

---

## 📊 実績記録テンプレート

開発中に記録しておくと便利：
```markdown
## 2025-11-02

### 使用状況
- Sonnet: 15回（$1.50）
- Opus:    2回（$2.00）

### Opus を使った理由
1. OAuth セキュリティレビュー
2. データベース設計の最終確認

### 結果
- ✅ 両方とも必要な使用だった
- ✅ Sonnetで十分な部分はSonnetを使えた
```

---

## 🎓 まとめ

### 基本方針
1. **まずSonnetで試す**
2. **2-3回で解決しなければOpus**
3. **重要な判断はOpus**
4. **日常作業はSonnet**

### 90-10 ルール
```
Sonnet: 90% のタスク（日常）
Opus:   10% のタスク（特別）
```

### コスト最適化
```
無駄にOpusを使わない
でも、必要な時は躊躇しない
```

### 品質とスピード
```
Sonnet: スピード重視
Opus:   品質重視
```

---

**このガイドを開発中に随時参照してください！** 📖