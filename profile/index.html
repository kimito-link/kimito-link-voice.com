<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{{name}} - KimiLink Voice</title>
    <meta name="description" content="{{description}}">
    
    <!-- DNS Prefetch & Preconnect -->
    <link rel="dns-prefetch" href="https://cdn.jsdelivr.net">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    
    <!-- Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+JP:wght@400;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    
    <!-- Styles -->
    <link rel="stylesheet" href="/css/styles.css">
    <link rel="stylesheet" href="/css/profile.css">
    <link rel="stylesheet" href="/css/request-modal.css">
</head>
<body>
    <!-- 宇宙背景エフェクト -->
    <div id="star-field"></div>
    <div class="galaxy-fog"></div>
    <div class="aurora"></div>

    <!-- ヘッダー -->
    <header class="public-header">
        <div class="header-container">
            <div class="logo-area" onclick="location.href='/'">
                <img src="/images/logo/RGB/透過/logo_funlink_RGB_ginga_color.png" alt="KimiLink Voice" class="header-logo">
                <span class="logo-text">KimiLink Voice</span>
            </div>
            
            <nav class="header-nav">
                <a href="/">ホーム</a>
                <a href="/narrators/">声優一覧</a>
                <a href="/thanks/">感謝のメッセージ</a>
            </nav>

            <button type="button" class="btn-login" onclick="location.href='/dashboard/'">
                <i class="fas fa-tachometer-alt"></i> ダッシュボード
            </button>
        </div>
    </header>

    <!-- プロフィールコンテンツ -->
    <main class="profile-main">
        <div class="container">
            <!-- プロフィールヘッダー -->
            <div class="profile-header">
                <div class="profile-cover" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);">
                    <img src="/images/logo/RGB/透過/logo_funlink_RGB_ginga_color.png" alt="KimiLink Voice" class="cover-logo">
                </div>
                
                <div class="profile-info">
                    <div class="profile-avatar-wrapper">
                        <img src="{{profile_image_url}}" alt="{{name}}" class="profile-avatar" width="120" height="120" loading="eager" decoding="sync">
                        <div class="rank-badge badge-{{rank}}">{{rankLabel}}</div>
                    </div>
                    
                    <div class="profile-details">
                        <h1 class="profile-name">{{name}}</h1>
                        <p class="profile-handle">@{{username}}</p>
                        
                        <div class="profile-stats">
                            <div class="stat-item">
                                <i class="fas fa-users"></i>
                                <span class="stat-number">{{followers_count}}</span>
                                <span class="stat-label">フォロワー</span>
                            </div>
                            <div class="stat-item">
                                <i class="fas fa-check-circle"></i>
                                <span class="stat-number">{{achievement_count}}</span>
                                <span class="stat-label">実績</span>
                            </div>
                            <div class="stat-item">
                                <i class="fas fa-heart"></i>
                                <span class="stat-number">{{engagement_count}}</span>
                                <span class="stat-label">エンゲージメント</span>
                            </div>
                        </div>
                        
                        <div class="profile-actions">
                            <button class="btn-request-large" onclick="openRequestModal()">
                                <i class="fas fa-paper-plane"></i> 依頼する
                            </button>
                            <a href="https://twitter.com/{{username}}" class="btn-follow-large">
                                <i class="fab fa-twitter"></i> フォロー
                            </a>
                        </div>
                    </div>
                </div>
            </div>

            <!-- プロフィール本文 -->
            <div class="profile-content">
                <!-- 左カラム -->
                <div class="profile-left">
                    <!-- 自己紹介 -->
                    <section class="profile-section">
                        <h2 class="section-title">
                            <i class="fas fa-user-circle"></i> 自己紹介
                        </h2>
                        <p class="profile-bio">{{description}}</p>
                    </section>

                    <!-- 料金表 -->
                    <section class="profile-section">
                        <h2 class="section-title">
                            <i class="fas fa-tag"></i> 料金
                        </h2>
                        <div class="pricing-card">
                            <div class="pricing-item">
                                <span class="pricing-label">基本料金</span>
                                <span class="pricing-value">¥<span id="pricePerChar">{{price_per_char}}</span>/文字</span>
                            </div>
                            <div class="pricing-item">
                                <span class="pricing-label">最低料金</span>
                                <span class="pricing-value">¥<span id="minimumPrice">{{min_price}}</span></span>
                            </div>
                            <div class="pricing-note">
                                <i class="fas fa-info-circle"></i>
                                文字数に応じて自動計算されます
                            </div>
                        </div>
                    </section>

                    <!-- 得意ジャンル -->
                    <section class="profile-section">
                        <h2 class="section-title">
                            <i class="fas fa-tags"></i> 得意ジャンル
                        </h2>
                        <div class="tag-list">
                            {{tags}}
                        </div>
                    </section>

                    <!-- サンプルボイス -->
                    <section class="profile-section">
                        <h2 class="section-title">
                            <i class="fas fa-headphones"></i> サンプルボイス
                        </h2>
                        <div class="sample-voice-list">
                            <div class="sample-voice-item">
                                <div class="sample-info">
                                    <i class="fas fa-microphone"></i>
                                    <span>自己紹介</span>
                                </div>
                                <audio controls class="sample-audio">
                                    <source src="/uploads/samples/{{username}}/intro.mp3" type="audio/mpeg">
                                </audio>
                            </div>
                            <div class="sample-voice-item">
                                <div class="sample-info">
                                    <i class="fas fa-microphone"></i>
                                    <span>ポートフォリオ1</span>
                                </div>
                                <audio controls class="sample-audio">
                                    <source src="/uploads/samples/{{username}}/portfolio1.mp3" type="audio/mpeg">
                                </audio>
                            </div>
                            <div class="sample-voice-item">
                                <div class="sample-info">
                                    <i class="fas fa-microphone"></i>
                                    <span>ポートフォリオ2</span>
                                </div>
                                <audio controls class="sample-audio">
                                    <source src="/uploads/samples/{{username}}/portfolio2.mp3" type="audio/mpeg">
                                </audio>
                            </div>
                        </div>
                    </section>
                </div>

                <!-- 右カラム -->
                <div class="profile-right">
                    <!-- 実績 -->
                    <section class="profile-section">
                        <h2 class="section-title">
                            <i class="fas fa-trophy"></i> 実績
                        </h2>
                        <div class="achievement-stats">
                            <div class="achievement-item">
                                <i class="fas fa-check-circle"></i>
                                <span>完了案件: <strong>{{achievement_count}}件</strong></span>
                            </div>
                            <div class="achievement-item">
                                <i class="fas fa-redo"></i>
                                <span>リピート率: <strong>85%</strong></span>
                            </div>
                        </div>
                    </section>

                    <!-- 対応時間 -->
                    <section class="profile-section">
                        <h2 class="section-title">
                            <i class="fas fa-clock"></i> 対応時間
                        </h2>
                        <div class="response-info">
                            <div class="info-item">
                                <span class="info-label">平均返信時間</span>
                                <span class="info-value">2時間以内</span>
                            </div>
                            <div class="info-item">
                                <span class="info-label">平均納期</span>
                                <span class="info-value">3日</span>
                            </div>
                        </div>
                    </section>

                    <!-- 感謝のメッセージ -->
                    <section class="profile-section">
                        <h2 class="section-title">
                            <i class="fas fa-heart"></i> 感謝のメッセージ
                        </h2>
                        <div class="thanks-preview">
                            <p class="thanks-note">まだメッセージがありません</p>
                            <a href="/{{username}}/thanks/" class="btn-view-thanks">
                                すべて見る <i class="fas fa-arrow-right"></i>
                            </a>
                        </div>
                    </section>
                </div>
            </div>
        </div>
    </main>

    <!-- フッター -->
    <footer class="public-footer">
        <div class="footer-container">
            <p>&copy; 2024 KimiLink Voice. All rights reserved.</p>
        </div>
    </footer>

    <!-- 依頼モーダル -->
    <div id="requestModal" class="request-modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>
                    <i class="fas fa-paper-plane"></i> 
                    <span id="modalNarratorName">{{name}}</span>に依頼する
                </h2>
                <button class="modal-close" onclick="closeRequestModal()">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            
            <div class="modal-body">
                <!-- 依頼者情報 -->
                <div class="request-section">
                    <h3><i class="fas fa-user"></i> 依頼者情報</h3>
                    
                    <!-- ログインアカウント情報 -->
                    <div class="twitter-account-info" id="twitterAccountInfo">
                        <div class="account-card">
                            <img src="/images/icon/kewXCUOt_400x400.jpg" alt="アバター" class="account-avatar" id="requesterAvatar">
                            <div class="account-details">
                                <div class="account-name" id="requesterDisplayName">読み込み中...</div>
                                <div class="account-handle" id="requesterTwitterHandle">@...</div>
                            </div>
                        </div>
                        <p class="account-note">
                            <i class="fas fa-info-circle"></i>
                            このアカウントで声優さんとやりとりします
                        </p>
                    </div>
                </div>

                <!-- スクリプト入力 -->
                <div class="request-section">
                    <h3><i class="fas fa-file-alt"></i> 依頼内容</h3>
                    <div class="form-group">
                        <label>スクリプト <span class="required">*</span></label>
                        
                        <!-- AI補助機能の説明 -->
                        <div class="ai-help-banner">
                            <i class="fas fa-robot"></i>
                            <div class="help-content">
                                <strong>AIがスクリプト作成をサポート！</strong>
                                <div class="help-step">
                                    <div class="step-item">
                                        <span class="step-number">1</span>
                                        <div class="step-content">
                                            <strong>応援ボイスのパターンを提案</strong>
                                            <p>→ ボタンを押すだけ！短・中・長の3パターンを自動生成</p>
                                        </div>
                                    </div>
                                    <div class="step-item">
                                        <span class="step-number">2</span>
                                        <div class="step-content">
                                            <strong>台本のイメージを膨らませる</strong>
                                            <p>→ 下のテキストエリアに「配信者を応援したい」などのふわっとしたアイデアを入力してボタンを押すと、具体的なスクリプト3パターンに変換！</p>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="ai-assist-buttons">
                            <button type="button" class="btn-ai-assist" onclick="generateCheerPattern()">
                                <i class="fas fa-magic"></i> 応援ボイスのパターンを提案
                            </button>
                            <button type="button" class="btn-ai-assist" onclick="expandScriptIdea()">
                                <i class="fas fa-lightbulb"></i> 台本のイメージを膨らませる
                            </button>
                            <button type="button" class="btn-clear-cache" onclick="clearAICache()" title="AIキャッシュをクリアして新鮮な提案を取得">
                                <i class="fas fa-trash-alt"></i> キャッシュクリア
                            </button>
                        </div>
                        <textarea 
                            id="requestScript" 
                            placeholder="読み上げてほしいスクリプトを入力してください&#10;&#10;💡 ふわっとしたイメージでもOK！&#10;例：「頑張ってる配信者を応援したい」&#10;→ AIが具体的なスクリプトを提案します&#10;&#10;または具体的なスクリプト：&#10;「こんにちは！今日も配信お疲れ様！&#10;いつも楽しい配信をありがとう！」"
                            rows="10"
                            oninput="calculatePrice()"
                            required
                        ></textarea>
                        <div class="char-count">
                            <span id="charCount">0</span> 文字
                        </div>
                        <div id="aiSuggestion" class="ai-suggestion" style="display: none;">
                            <div class="suggestion-header">
                                <div class="suggestion-title">
                                    <i class="fas fa-robot"></i> AI提案
                                </div>
                                <div class="suggestion-actions">
                                    <button type="button" class="btn-regenerate" onclick="regenerateSuggestion()">
                                        <i class="fas fa-redo"></i> やり直す
                                    </button>
                                    <button type="button" class="btn-edit-suggestion" onclick="editSuggestion()">
                                        <i class="fas fa-edit"></i> 編集する
                                    </button>
                                    <button type="button" class="btn-use-suggestion" onclick="useSuggestion()">
                                        <i class="fas fa-check"></i> この提案を使う
                                    </button>
                                </div>
                            </div>
                            <textarea class="suggestion-content-editable" id="suggestionContentEditable" rows="10"></textarea>
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label>用途・目的</label>
                        <select id="requestPurpose">
                            <option value="">選択してください</option>
                            <option value="youtube">YouTube動画</option>
                            <option value="commercial">CM・広告</option>
                            <option value="game">ゲーム</option>
                            <option value="anime">アニメ</option>
                            <option value="stream">配信</option>
                            <option value="other">その他</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label>希望納期</label>
                        <input type="date" id="requestDeadline">
                    </div>
                    
                    <div class="form-group">
                        <label>備考・特記事項</label>
                        <textarea 
                            id="requestNotes" 
                            placeholder="イメージ、トーン、その他ご要望があればご記入ください"
                            rows="3"
                        ></textarea>
                    </div>
                </div>

                <!-- 料金計算 -->
                <div class="request-section price-section">
                    <h3><i class="fas fa-yen-sign"></i> 料金</h3>
                    <p class="price-note">
                        <i class="fas fa-info-circle"></i>
                        クリエイターが受け取れる最低金額は <strong>¥<span id="displayMinPrice">{{min_price}}</span></strong> です
                    </p>
                    <div class="price-detail">
                        <div class="price-row">
                            <span>文字数</span>
                            <span><strong id="priceCharCount">0</strong> 文字</span>
                        </div>
                        <div class="price-row">
                            <span>単価</span>
                            <span>¥<span id="pricePerChar">{{price_per_char}}</span> / 文字</span>
                        </div>
                        <div class="price-row">
                            <span>小計</span>
                            <span>¥<span id="priceSubtotal">0</span></span>
                        </div>
                        <div class="price-row minimum-price" id="minimumPriceRow" style="display: none;">
                            <span>最低料金適用</span>
                            <span>¥<span id="minimumPrice">{{min_price}}</span></span>
                        </div>
                        <div class="price-divider"></div>
                        <div class="price-row price-total">
                            <span>合計金額</span>
                            <span>¥<span id="priceTotal">0</span></span>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="modal-footer">
                <button class="btn-cancel" onclick="closeRequestModal()">
                    キャンセル
                </button>
                <button class="btn-submit" onclick="submitRequest()">
                    <i class="fas fa-paper-plane"></i> 依頼を送信
                </button>
            </div>
        </div>
    </div>

    <!-- スクリプト -->
    <script src="/js/script.js"></script>
    <script src="/js/request-modal.js"></script>
</body>
</html>
